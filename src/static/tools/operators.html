<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>

        <link rel='stylesheet prefetch' href='//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css'>
        <link rel='stylesheet prefetch' href='//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css'>

        <style>
            body {
                 padding: 40px;
            }
            tbody tr:hover,
            tbody tr:hover td {
                background: #ffcc78!important;
            }
        </style>
    </head>
    <body>
        <div class="container" ng-app="sortApp" ng-controller="mainController">

          <div class="alert alert-info">
            <p>Sort Type: {{ sortType }}</p>
            <p>Sort Reverse: {{ sortReverse }}</p>
            <p>Search Query: {{ searchOperators }}</p>
          </div>

          <form>
            <div class="form-group">
              <div class="input-group">
                <div class="input-group-addon"><i class="fa fa-search"></i></div>
                <input type="text" class="form-control" placeholder="Filter operators" ng-model="searchOperators">
              </div>
            </div>
          </form>

          <table class="table table-bordered table-striped">

            <thead>
              <tr>
                <td>
                  <a href="#" ng-click="sortType = 'operatorID'; sortReverse = !sortReverse">
                    Operator ID
                    <span ng-show="sortType == 'operatorID' && !sortReverse" class="fa fa-caret-down"></span>
                    <span ng-show="sortType == 'operatorID' && sortReverse" class="fa fa-caret-up"></span>
                  </a>
                </td>
                <td>
                  <a href="#" ng-click="sortType = 'tradingName'; sortReverse = !sortReverse">
                  Trading Name
                    <span ng-show="sortType == 'tradingName' && !sortReverse" class="fa fa-caret-down"></span>
                    <span ng-show="sortType == 'tradingName' && sortReverse" class="fa fa-caret-up"></span>
                  </a>
                </td>
                <td>
                  <a href="#" ng-click="sortType = 'vcLocations'; sortReverse = !sortReverse">
                  VCLocations
                    <span ng-show="sortType == 'vcLocations' && !sortReverse" class="fa fa-caret-down"></span>
                    <span ng-show="sortType == 'vcLocations' && sortReverse" class="fa fa-caret-up"></span>
                  </a>
                </td>
                <td>
                  <a href="#" ng-click="sortType = 'location'; sortReverse = !sortReverse">
                  Location
                    <span ng-show="sortType == 'location' && !sortReverse" class="fa fa-caret-down"></span>
                    <span ng-show="sortType == 'location' && sortReverse" class="fa fa-caret-up"></span>
                  </a>
                </td>
              </tr>
            </thead>

            <tbody>
              <tr ng-repeat="operator in operators | orderBy:sortType:sortReverse | filter:searchOperators">
                <td>{{ operator.operatorID }}</td>
                <td>{{ operator.tradingName }}</td>
                <td>{{ operator.vcLocations }}</td>
                <td>{{ operator.location }}</td>
              </tr>
            </tbody>

          </table>

        </div>

        <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.8/angular.js"></script>


        <script>

            var module = angular.module('sortApp', []);

            module.controller('mainController', function($scope, $http) {
                $scope.sortType     = 'operatorID';   // set the default sort type
                $scope.sortReverse  = false;          // set the default sort order
                $scope.searchOperators   = '';        // set the default search/filter term
                $scope.operators = [];

                $http.jsonp('http://sjp.impartmedia.com/be/getOperatorsInformation?callback=JSON_CALLBACK&q=188').
                  then( function ( response ) {

                    var operators = response.data.Operators;
                    var aTemp = [];

                    for (var key in operators) {
                        var sLocations = "";

                        if (Object.keys(operators[key]['Locations']).length) {
                            console.log(Object.keys(operators[key]['Locations']).length);
                            sLocations = operators[key]['Locations'][0]['Description'];
                        }

                        aTemp.push({
                            operatorID: operators[key]['OperatorID'],
                            tradingName: operators[key]['TradingName'],
                            vcLocations: sLocations,
                            location: operators[key]['Location']
                        });
                    }


                    $scope.operators = aTemp;

                });
            });

        </script>
    </body>
</html>
